{% extends "mapentity:mapentity/base.html" %}

{% block extrabody %}

    {{ block.super }}
    
    <script type="text/javascript">
	    /*
	     * Force layers in polygons defined in settings
	     */
	    
	    var polygons_forced_layers = [];
		var map;
		
        $(window).on('detailmap:ready', function (e, data) {
        	//alert('ok');
        	map = data.map;
	        
	        map.on('move', function() {
	        	$.each(polygons_forced_layers, function(index, value){
		    		if(value[0].getBounds().contains(map.getCenter())){
		    			// switch std map
		    			map.removeLayer(value[1]);
		    		}
		    		else {
		    			// switch OSM map
					    map.addLayer(value[1]);
		    		}
	        	});
	    	});
	        
	        $.get(
	        	"{% url 'core:force_layers' %}",
	            function(result){
	            	alert(result.length);
	            	$.each(result, function(index, value){
	            		polygons_forced_layers.push([
	            		    new L.polygon(value.coordinates),
	            		    new L.TileLayer(value.layer, {minZoom: 0, maxZoom: 18, attribution: ''})
	            		]);
	            		//alert(polygons_forced_layers.length);
	            		if(polygons_forced_layers[polygons_forced_layers.length-1][0].getBounds().contains(map.getCenter())){
			    			// switch std map
			    			map.removeLayer(polygons_forced_layers[polygons_forced_layers.length-1][1]);
			    		}
			    		else {
			    			// switch OSM map
						    map.addLayer(polygons_forced_layers[polygons_forced_layers.length-1][1]);
			    		}
	            	});
              }
	        );
        });
		
	</script>
	
{% endblock %}
